{% include base_path %}

{% if post.id %}
  {% assign title = post.title | markdownify | remove: "<p>" | remove: "</p>" %}
{% else %}
  {% assign title = post.title %}
{% endif %}

<div class="{{ include.type | default: "list" }}__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    {% if post.collection == 'publications' %}
      <div class="publication-entry">
        <div class="publication-title"><b>{{ title }}</b></div>
        
        {% comment %} Reformat authors from "Last, First and Last, First" to "First Last, First Last, and First Last" {% endcomment %}
        {% assign author_list = post.authors | split: " and " %}
        {% assign formatted_authors = "" %}
        {% for author_name in author_list %}
          {% assign parts = author_name | split: ", " %}
          {% if parts.size == 2 %}
            {% assign first_name = parts[1] %}
            {% assign last_name = parts[0] %}
            {% assign current_formatted_name = first_name | append: " " | append: last_name %}
          {% else %}
            {% assign current_formatted_name = author_name %}
          {% endif %}

          {% if forloop.first %}
            {% assign formatted_authors = current_formatted_name %}
          {% elsif forloop.last %}
            {% assign formatted_authors = formatted_authors | append: ", and " | append: current_formatted_name %}
          {% else %}
            {% assign formatted_authors = formatted_authors | append: ", " | append: current_formatted_name %}
          {% endif %}
        {% endfor %}
        <div class="publication-authors">With: {{ formatted_authors }}</div>

        <div class="publication-venue">
          {% if post.keywords contains "preprint" %}
            Preprint
          {% else %}
            Accepted to {{ post.venue }}
            {% if post.year %}, {{ post.year }}{% endif %}
          {% endif %}
        </div>
        <div class="publication-links">
          {% if post.paperurl %}
            {% if post.keywords contains "preprint" %}
              <a href="{{ post.paperurl }}" class="publication-link" target="_blank" rel="noopener noreferrer">
                <img src="{{ site.baseurl }}/images/arxiv-logo.png" alt="arXiv" class="arxiv-logo">
              </a>
            {% else %}
              <a href="{{ post.paperurl }}" class="publication-link" target="_blank" rel="noopener noreferrer">
                <i class="fas fa-file-pdf"></i> Paper
              </a>
            {% endif %}
          {% endif %}
        </div>
      </div>
    {% else %}
      <h2 class="archive__item-title" itemprop="headline">
        {% if post.link %}
          <a href="{{ post.link }}">{{ title }}</a> <a href="{{ base_path }}{{ post.url }}" rel="permalink"><i class="fa fa-link" aria-hidden="true" title="permalink"></i><span class="sr-only">Permalink</span></a>
        {% else %}
          <a href="{{ base_path }}{{ post.url }}" rel="permalink">{{ title }}</a>
        {% endif %}
      </h2>
      {% if post.excerpt %}
        <p class="archive__item-excerpt" itemprop="description">{{ post.excerpt | markdownify }}</p>
      {% endif %}
    {% endif %}

  </article>
</div>
